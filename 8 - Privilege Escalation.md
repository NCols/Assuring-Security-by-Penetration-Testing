# PRIVILEGE ESCALATION

There are two types of privilege escalation as follows:

• **Vertical** privilege escalation: In this type, a user with lower privilege is able to access the application functions designed for the highest privilege user. For example, a content management system where a user is able to access the system administrator functions.
• **Horizontal** privilege escalation: This happens when a normal user is able to access functions designed for other normal users. For example, in an Internet banking application, user A is able to access the menu of user B.

The following are the several privilege escalation vectors that can be used to gain
unauthorized access to the target:

• Local exploits
• Exploiting a misconfiguration such as a home directory that is accessible, which contains an SSH private key allowing access to other machines
• Exploiting weak passwords on the target
• Sniffing the network traffic to capture the credentials
• Spoofing the network packets

## 1. PRIVILEGE ESCALATION USING A LOCAL EXPLOIT

1) nmap the guest
2) check the open ports and associated services
3) search for vulnerable services in metasploit (ex: msf> search distccd)
4) from the previous search we find an exploit => config & run => this allows us to get access to the machine
5) with whoami we can check which user we got
6) explore system to get more information about it (ex: uname -r)
7) search exploit-db for a privilege escalation exploit
8) follow exploit instructions and pwn



## 2. PASSWORD ATTACK TOOLS

According to how the password attack is done, this process can be differentiated into the following types:

• **Offline** attack: In this method, the attacker gets the hash file from the target machine and copies it to the attacker's machine. The attacker then uses the password-cracking tool to crack the password. The advantage of using this method is that the attacker doesn't need to worry about the password-blocking mechanism available in the target machine because the process is done locally.
• **Online** attack: In this method, the attacker tries to login to the remote machine using the guessed credentials. This technique may trigger the remote machine to block the attacker machine after several failed password guess attempts.


### 2.1 Offline attack tools

#### HASH-IDENTIFIER

#### HASHCAT

There are six attack modes supported by Hashcat:

• **Straight**: The program will use each line from a text file as the password candidate. This is the default attack mode. The other name of this mode is dictionary attack.
• **Combination**: Hashcat will combine each word in the dictionary. For example, if we have the following words in the dictionary:
  ° password
  ° 01
Hashcat will create the following password candidates:
  °  passwordpassword
  °  password01
  °  01password
  °  0101
• **Toggle case**: The program will generate all the possible combinations of upper and lowercase variants of each word in the dictionary.
• **Brute force**: The program will try all combinations from a keyspace. This attack mode is being replaced by the mask attack. For example, if we specify
the password candidates of two-character length and charset A-Z, Hashcat will generate the password candidates from AA to ZZ.
• **Permutation**: The program will create all the permutations of the word. For example, in the dictionary, we have AB as the word. The permutation of this is as follows:
  ° AB
  ° BA
• **Table-lookup**: For each word in the dictionary, the program automatically generates masks. You can get more information about this attack mode at http://hashcat.net/wiki/doku.php?id=table_lookup_attack .


#### RAINBOWCRACK

Uses rainbow tables instead of brute forcing. Faster.

Kali Linux includes three RainbowCrack tools that must be run in sequence to make things work:

    • rtgen : This tool is used to generate the rainbow tables. Sometimes, this process is called the precomputation stage. The rainbow tables contain plaintext, hash, hash algorithm, charset, and plaintext length range. The precomputation stage is a time-consuming process, but once the precomputation is finished, the password cracker tool will have a much faster performance compared to the brute force cracker. The rtgen tool supports the following hash algorithms: LanMan , NTLM , MD2 , MD4 , MD5 , SHA1 ,and RIPEMD160 .
    • rtsort : This tool is used to sort the rainbow tables generated by rtgen .
    • rcrack : This tool is used to look up the rainbow tables to find the hash.

Here's how it's used:

> rtgen

This will display a simple usage instruction and two examples for creating the rainbow tables on your screen. For our exercise, we are going to create two rainbow tables with the following characteristics:

    • hash algorithm: md5
    • charset: loweralpha
    • plaintext_len_min: 1
    • plaintext_len_max: 5
    • rainbow_table_index: 0
    • rainbow_ chain_length: 2000
    • rainbow_chain_count: 8000
    • part_index: 0

To create these rainbow tables, give the following command:

>  rtgen md5 loweralpha 1 5 0 2000 8000 testing

The first rainbow table will be saved in the md5_loweralpha#1-5_0_2000x8000_0.rt file under the /usr/share/rainbowcrack/ directory.

To generate the second rainbow table, give the following command:

>  rtgen md5 loweralpha 1 5 1 2000 8000 0

It takes around 3 minutes to generate these two rainbow tables on my system. The result will be saved in the md5_loweralpha#1-5_1_2000x8000_0.rt file.

Careful, takes time and disk space!

After successfully creating the rainbow tables, the next step is to sort the tables. You can use the rtsort tool for this purpose. To start the rtsort command line, use the console to execute the following command:

>  rtsort

This will display a simple usage instruction and example on your screen. In ourexercise, we are going to sort the first rainbow table as follows:

>  rtsort md5_loweralpha#1-5_0_2000x8000_0.rt
    
	md5_loweralpha#1-5_0_2000x8000_0.rt:
    1176928256 bytes memory available
    loading rainbow table...
    sorting rainbow table by end point...
    writing sorted rainbow table...

We do the same process for the second rainbow table file:

>  rtsort md5_loweralpha#1-5_1_2000x8000_0.rt
    
	md5_loweralpha#1-5_1_2000x8000_0.rt:
    1177255936 bytes memory available
    loading rainbow table...
    sorting rainbow table by end point...
    writing sorted rainbow table...

The rtsort tool will save the result in the original file.

Do not interrupt the rtsort program; otherwise, the rainbow table being processed will get damaged.

Next, we want to use the generated rainbow tables to crack an MD5 password hash of five characters length. Bear in mind that because we only use two rainbow tables, the success rate is around 86 percent.

To start the rcrack command line, use the console to execute the following command:

>  rcrack

Let's use rcrack to crack this:

>  rcrack /usr/share/rainbowcrack/*.rt -h ab56b4d92b40713acc5af89985d4b786



#### JOHN THE RIPPER

Cf cheat sheet

#### JOHNNY

John the ripper gui


#### OPHCRACK


#### CRUNCH


Crunch ( http://sourceforge.net/projects/crunch-wordlist/ ) is a tool used to create wordlists based on user criteria. This wordlist is then used during the password-cracking process.

>  crunch

For our first exercise, we will create a wordlist of five characters and save the result in the 5chars.txt file. The following is the command to do this:

>  crunch 1 5 –o 5chars.txt

In our next exercise, we will create a wordlist of lowercase letters and numbers with lengths from 1 to 4 . The result will be saved in the wordlist.lst file.

The command to do this action is as follows:

>  crunch 1 4 -f /usr/share/crunch/charset.lst lalpha-numeric -o wordlist.lst


### 2.2 ONLINE ATTACK TOOLS

#### CEWL

Cf cheat sheet

#### HYDRA

Cf cheat sheet

#### MEDUSA

Cf cheat sheet


## 3. NETWORK SPOOFING TOOLS
TBD